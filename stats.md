 # code for basis

     basis = np.zeros((nx * 2, 5))
     basis[:, 0] = np.array([6., 6.8, 7., 7.4, 7.8, 8.2, 8.8, 9.2, 10., 11.4, 12.2, 13.4, 20., 0.,
                             1.8, 3.8, 5.8, 6.6, 8.4, 10.2, 11.4, 13., 14.6, 15.6, 17.2, 20.])
    
     basis[:, 1] = np.array([6., 7.48513957, 7.81997223, 8.41189715, 8.16728452, 8.4708108,
                             9.54454019, 10.26686085, 10.23037205, 11.8109363, 12.50000342,
                             13.90636496, 20., 0., 2.0736383, 4.67533416, 5.96686564, 6.86340497,
                             9.41861856, 10.78509445, 12.22915791, 14.02335437, 15.74004816,
                             15.89395627, 17.42943277, 20.])
    
     basis[:, 2] = np.array([6., 7.38689286, 7.72294127, 8.32688833, 7.95670251, 8.2823111,
                             9.52535605, 10.02413205, 10.1637055, 11.67041769, 12.35053234, 13.8070384, 20.,
                             0., 1.82531358, 4.51620829, 5.90799749, 6.79589611, 9.34822995,
                             10.73910471, 11.9835629, 13.93064889, 15.66466243, 15.67794821, 17.28655007, 20.])
    
     basis[:, 3] = np.array([6., 5.7827818, 7.14493751, 8.71040373, 6.53284159, 8.47767034, 7.65621351,
                             9.13904636, 13.82271469, 11.30440854, 13.97073257, 12.89681254, 20.,
                             0., -1.30811039, 3.2724712, 7.85075504, 8.92565511,
                             10.22626494, 9.76080429, 12.88540459, 12.96289298, 18.23389962, 17.60080336,
                             16.14748156, 20.])
     basis[:, 4] = np.array([6., 5.74133844, 7.33800593, 8.98332517, 6.50921693, 8.55970013,
                             7.61256167, 9.31338245, 13.91569761, 11.38711136, 14.09736454, 12.88094703,
                             20., 0., -1.21644538, 2.99286283, 7.82685527, 8.886719,
                             10.30002114, 9.83331944, 12.8647886, 13.0071202, 18.33810794, 17.65912744,
                             16.14631291, 20.])
     eta = 1e-1   Note: step size rule 1 does not work well when dimension is larger than 2  1e-2
     delta = 1e-1   exploration parameter
     nw = 5
     wt = np.zeros((nw, maxItr))
     wt[:, 0] = np.array([1, 0, 0, 0, 0])
     meas = np.zeros((maxItr,))   Distance me
    
     for i in range(maxItr - 1):
         x = np.reshape(np.matmul(basis, wt[:, i]), (nx*2, 1))
         s, index = human_feedback(x, human_cluster)
         meas[i] = s
         if s < 1e-2:
             break
         ut = np.random.random((nw, ))
         ut = ut / np.linalg.norm(ut)
         w_plus = wt[:, i] + ut * delta
         x_plus = np.reshape(np.matmul(basis, w_plus), (nx * 2, 1))
         s_plus, _ = human_feedback(x_plus, human_cluster)
         w_minus = wt[:, i] - ut * delta
         x_minus = np.reshape(np.matmul(basis, w_minus), (nx * 2, 1))
         s_minus, _ = human_feedback(x_minus, human_cluster)
    
         gt = nw / 2 / delta * (s_plus - s_minus) * ut   gradient
    
         wt[:, i + 1] = wt[:, i] - eta * gt.ravel()   gradient descent
         print(i, s, wt[:, i + 1])
    
     x = np.reshape(np.matmul(basis, wt[:, i]), (nx*2, 1))
     workspace_plot(x, nx, human_cluster, obstacle)
     plt.show()
 
 
 # count the number of points in the polygon
    # for polygon in human_cluster.values():
    #     cluster = Polygon(polygon)
    #     point = []
    #     for i in range(nx):
    #         if Point((x[i], x[i+nx])).within(cluster):
    #             point.append((x[i], x[i+nx]))
    #     # point in polygon
    #     if point:
    #         score += get_score(point, polygon)
    
  # workspace
  
    # w = Workspace()
    # with open('data/workspace', 'wb') as filehandle:
    #     pickle.dump(w, filehandle)
    # with open('data/case1', 'rb') as filehandle:
    #     w = pickle.load(filehandle)
    # print(w.regions)
    # w.init_goal = {'s': (6, 0), 't': (13, 17)}
    # w.plot_workspace()
    # plt.grid(b=True, which='major', color='k', linestyle='--')
    # plt.show()

# distance between the center of cluster and trajectory
    # def get_score(point, polygon):
    #     rho = 10
    #     cx, cy, r = make_circle(polygon)
    #     score = 0
    #     for p in point:
    #         score += rho/(np.linalg.norm(np.array(p) - np.array([cx, cy])))
    #     return score

# parameter
1. for distance to the center, 

eta = 1e-2  # Note: step size rule 1 does not work well when dimension is larger than 2  
delta = 1e0  # exploration parameter

2. for counting the number

eta = 1e-1  # Note: step size rule 1 does not work well when dimension is larger than 2 
delta = 1e1  # exploration parameter

3.   dist = np.sum([np.linalg.norm([x[i] - x[i + 1], x[i + nx] - x[i + 1 + nx]]) for i in range(nx - 1)])
     
     for obstacles, score += 10 or 1
     
     if np.fabs(dist-dist0) < 1 and s-dist < 1e-2:
        break
      
# result

locally perturbation works better than full perturbation when the length doubles


# static 
eta = 1e-1, score = score + dist
### k = 20
update iter - full/local
0-0 0-1 1-0 1-1 2-0 2-1 3-0 3-1 
[59, 56, 9, 33, 111, 27, 8, 1, 
1, 5, 8, 4, 17, 1, 106, 44, 
29, 12, 228, 118, 147, 39, 55, 76, 
42, 46, 22, 4, 39, 5, 26, 36, 
1, 1, 1, 1, 1, 1, 40, 20, 
2, 5, 17, 19, 35, 4, 29, 10, 
1, 1, 1, 1, 1, 1, 1, 1, 
23, 19, 21, 23, 1, 47, 90, 43, 
1, 1, 23, 32, 129, 46, 27, 30, 
181, 62, 1, 1, 227, 1, 69, 9, 
156, 197, 1, 1, 4, 48, 1, 1, 
5, 2, 1, 2, 1, 1, 1, 1, 
45, 10, 35, 48, 1, 1, 1, 1, 
1, 1, 62, 7, 1, 1, 1, 1, 
1, 1, 224, 26, 243, 9, 23, 23, 
29, 113, 72, 39, 37, 17, 14, 15, 
1, 10, 21, 4, 1, 1, 1, 1, 
227, 12, 33, 58, 158, 55, 1, 1, 
35, 120, 81, 12, 93, 89, 9, 20,]

44.2105   35.4737   45.3158   22.7895   65.6316   20.7368   26.4737   17.5789
67.5899   53.7860   68.0605   29.0337   80.7418   25.8990   32.0839   20.5867

### k = 30
[27, 4, 23, 6, 5, 6, 1, 1, 
53, 35, 333, 15, 54, 22, 1, 1, 
54, 82, 60, 26, 59, 1, 26, 16, 
21, 8, 17, 11, 47, 301, 147, 66, 
66, 11, 11, 32, 65, 19, 43, 57, 
72, 130, 36, 4, 1, 1, 51, 2, 
711, 10, 39, 26, 106, 21, 22, 38, 
81, 31, 263, 141, 813, 4, 37, 1, 
8, 13, 160, 17, 152, 48, 35, 6, 
74, 34, 108, 248, 371, 62, 25, 15, 
15, 10, 7, 19, 84, 63, 81, 33, 
54, 9, 1, 1, 74, 14, 10, 59, 
44, 56, 50, 87, 13, 2, 21, 7, 
80, 21, 70, 42, 25, 105, 4, 4, 
112, 51, 174, 36, 53, 99, 28, 47, 
1, 6, 46, 21, 146, 38, 6, 14, 
9, 8, 1, 7, 7, 4, 21, 1, 
22, 14, 5, 8, 22, 42, 1, 1, 
8, 5, 9, 20, 2, 1, 1, 1, 
1, 1, 38, 38, 1, 1, 1, 4, ]
75.6500   26.9500   72.5500   40.2500  105.0000   42.7000   28.1000   18.7000
152.9105   32.1108   91.9957   58.6855  186.8430   68.7651   34.8152   22.5227
### k = 40
[22, 37, 100, 24, 49, 14, 270, 33, 
44, 9, 17, 141, 67, 16, 37, 12, 
45, 50, 34, 23, 50, 60, 317, 15, 
263, 24, 28, 28, 52, 2, 3, 4, 
61, 98, 2, 6, 12, 111, 35, 53, 
19, 8, 98, 10, 36, 20, 3, 63, 
56, 82, 34, 93, 319, 347, 660, 80, 
93, 68, 417, 178, 24, 32, 2, 4, 
264, 112, 640, 18, 172, 14, 84, 31, 
32, 34, 28, 23, 22, 9, 47, 41, 
48, 31, 155, 58, 49, 18, 47, 81, 
16, 48, 105, 12, 15, 20, 18, 59, 
57, 14, 46, 9, 42, 22, 29, 4, 
1, 1, 16, 26, 14, 17, 22, 37, 
92, 6, 38, 84, 71, 29, 1, 1, 
199, 20, 66, 18, 1, 1, 1, 1, 
19, 18, 48, 20, 7, 20, 64, 35, 
2, 6, 65, 14, 108, 7, 56, 7, 
11, 110, 80, 10, 10, 6, 2, 12,]

70.7368   40.8421  106.1579   41.8421   58.9474   40.2632   89.3684   30.1579
81.4765   36.4437  157.9902   48.4014   75.0403   78.3545  163.3365   26.7463
### k = 50
[171, 25, 164, 26, 265, 240, 329, 18, 
33, 23, 14, 91, 169, 24, 167, 132, 
30, 76, 1319, 61, 75, 122, 419, 89, 
178, 92, 112, 32, 97, 29, 77, 70, 
88, 17, 59, 39, 349, 27, 165, 12, 
45, 65, 60, 13, 31, 22, 33, 8, 
45, 85, 62, 56, 218, 18, 55, 55, 
80, 188, 67, 34, 74, 81, 222, 143, 
364, 225, 183, 46, 33, 8, 31, 18, 
166, 140, 55, 446, 72, 5, 8, 1, 
19, 202, 61, 2, 59, 290, 1, 1, 
108, 27, 50, 30, 859, 65, 315, 11, 
30, 112, 41, 209, 65, 7, 50, 29, 
36, 20, 12, 3, 18, 56, 2, 3, 
92, 22, 56, 38, 586, 152, 137, 21, 
107, 21, 72, 34, 64, 283, 314, 71, 
122, 163, 21, 77, 90, 187, 106, 40, 
387, 47, 109, 46, 237, 17, 6, 24, 
105, 147, 57, 182, 40, 415, 259, 21, 
45, 28, 24, 60, 313, 274, 294, 102 ]

112.5500   86.2500  129.9000   76.2500  185.7000  116.1000  149.5000   43.4500
102.5072   69.0133  283.4336  101.6697  213.1723  123.4943  133.0111   43.7053

### k = 60
[403, 73, 53, 70, 67, 55, 158, 30,
228, 127, 46, 112, 197, 126, 249, 116,
137, 92, 84, 257, 54, 94, 87, 29,
95, 102, 210, 283, 59, 245, 368, 121,
49, 33, 242, 71, 559, 125, 259, 22,
53, 10, 29, 32, 47, 20, 73, 63,
32, 242, 56, 39, 32, 158, 252, 30,
47, 68, 26, 20, 557, 33, 217, 586,
42, 26, 492, 47, 112, 26, 16, 48,
54, 147, 198, 136, 416, 69, 12, 6,
119, 42, 115, 158, 83, 19, 130, 31,
44, 314, 267, 20, 39, 31, 51, 34,
69, 9, 277, 47, 10, 3, 194, 5,
25, 236, 12, 120, 14, 24, 60, 42,
18, 36, 96, 341, 151, 49, 23, 71,
38, 27, 274, 45, 22, 63, 95, 122,
36, 34, 430, 23, 91, 21, 30, 29,
134, 38, 192, 7, 20, 34, 71, 253,
167, 17, 27, 13, 23, 19, 78, 16, ]

94.2105   88.0526  164.5263   96.8947  134.3684   63.8947  127.5263   87.0526
93.4122   88.4204  140.3228   98.5776  176.2915   61.4382  101.8389  134.5525

# online

---------------------------k = 20-------------------------
0 29.642141719213328, 0 29.642141719213328,
3 33.38229975136284, 1 30.50472841671594,
0 29.642141719213328, 0 29.642141719213328,
5 35.20311010442395, 3 30.54064382945976,
3 30.14121093651887, 8 30.783006563434423,
2 30.010817159246752, 2 30.01555990938506,
1 31.347205296149994, 3 33.21216597007948,
4 33.38076933712472, 10 32.632236023518125,
1 36.96931189960325, 3 29.64617497938847,
5 35.29042414394217, 2 30.218035285726703,
0 29.642141719213328, 0 29.642141719213328,
0 29.642141719213328, 0 29.642141719213328,
1 30.955687478934227, 1 29.82866709353986,
3 32.071056571026105, 1 29.72165775789149,
6 34.35234258128784, 5 29.995837207594096,
1 29.864542117971236, 18 31.146641690464815,
8 35.09181431456858, 3 30.52287798284513,
0 29.642141719213328, 0 29.642141719213328,
4 31.768451549637565, 5 30.32838903872768,
0 29.642141719213328, 0 29.642141719213328,
[2.3500   31.8841    3.2500   30.3475
2.3681    2.4206    4.4352    0.9930]
---------------------------k = 30-------------------------
0 29.642141719213328, 0 29.642141719213328,
2 32.777748988262346, 28 30.87276012681865,
14 37.75914649077419, 1 31.669941583148212,
5 33.467685894678084, 29 30.999375111324465,
10 39.61085735685441, 5 30.992731032088916,
6 34.60579058271137, 2 29.748369523117567,
10 45.58741298336967, 5 34.273189528072244,
7 39.11925045472682, 1 29.482598857521065,
6 34.30453918491853, 1 34.55524904066623,
48 63.71633414020583, 4 32.62312316165048,
1 38.28042715860628, 1 32.828048353892044,
3 30.919801732100716, 8 30.461499933604006,
5 31.0037984773279, 2 29.966180228585184,
0 29.642141719213328, 0 29.642141719213328,
0 29.642141719213328, 0 29.642141719213328,
0 29.642141719213328, 0 29.642141719213328,
1 30.449900056443482, 2 30.344447186716888,
13 37.02484715717159, 8 30.171120375032732,
17 41.085181016588685, 3 41.634108977115034,
6 30.92890830637676, 4 29.92206221426937,
[5.5789   34.4997    5.2000   31.4557
5.1888    4.7006    8.3326    2.8434]

---------------------------k = 40-------------------------
12 33.33091412687535, 9 33.99029991398757,
19 39.83986206830678, 10 35.86218220825433,
7 36.28013328680626, 9 33.71225070210351,
20 47.7599877579268, 3 30.642058596575815,
8 49.49514956754499, 8 30.973247592163315,
19 45.34523556071964, 4 29.58712648484685,
26 45.52582951074817, 8 29.692823493386914,
5 36.3733052771586, 4 32.065693204286504,
0 29.642141719213328, 0 29.642141719213328,
17 41.146034328582004, 5 46.692490201687946,
17 47.472421642309975, 10 48.749218154515546,
16 36.432614579038926, 17 39.33042825443107,
0 29.642141719213328, 0 29.642141719213328,
19 39.17853334650102, 7 37.88621795669549,
15 41.789609723402954, 4 46.81773164251894,
6 34.04853685047149, 11 30.5121251563698,
6 36.85078376452466, 12 32.33440136163228,
11 41.67725287443037, 9 30.60966098944864,
20 44.66925967180479, 17 45.20153278802071,
1 30.755146763539468, 8 37.49018262280868,
[12.2000   39.3627    7.7500   35.5717
7.6681    6.1413    4.6326    6.5086]
---------------------------k = 50-------------------------
9 41.166445061960154, 5 30.937515049827095,
10 43.762883598059446, 12 51.24881534755876,
13 37.0275948142319, 4 33.60955787391156,
23 41.142337492771695, 1 31.377614630702784,
3 33.92531496377712, 3 39.15238567812995,
14 44.08234227338595, 18 40.0121142533006,
0 29.642141719213328, 0 29.642141719213328,
1 38.43137369760739, 26 37.37594415308048,
1 30.277436038936372, 2 31.332166976929212,
5 32.0206709709477, 1 29.846608224766435,
1 33.534735080551656, 3 29.315149952743173,
35 46.04381602340571, 2 32.166431518268986,
46 57.69575966118444, 13 47.508273733897916,
24 52.24013924047939, 11 36.26873840973706,
8 35.90568919425728, 4 41.89119930124845,
25 49.88109699847504, 8 33.74707292346071,
0 29.642141719213328, 0 29.642141719213328,
1 29.53313433703007, 1 30.333497479445228,
4 33.99892244309719, 26 37.50304430876649,
24 51.31694894751998, 12 39.15427102980873,
[12.3500   39.5635    7.6000   35.6032
13.0999    8.5223    8.1072    6.1836]
---------------------------k = 60-------------------------
33 43.606209118105255, 25 38.78962782608821,
5 34.26171849090625, 2 34.993332146403034,
24 46.111232399463695, 6 60.52716923370049,
0 29.642141719213328, 0 29.642141719213328,
40 48.608060186365634, 10 39.43549930539893,
48 52.04112966669636, 2 33.21718450977984,
34 53.164630260127396, 11 32.05821529141824,
5 38.831619107869834, 7 31.781135682913142,
15 48.42420009949615, 2 34.31773689533403,
16 35.44580384523425, 11 31.367309902507788,
25 45.6561454445513, 1 29.823391616191756,
48 50.376878644188054, 48 52.658548747721355,
16 45.83704965203258, 8 45.82937632066946,
3 34.906819800462834, 1 34.187578171538526,
48 51.49993437436484, 19 38.40525049133549,
29 50.58493083351129, 32 38.75314673827815,
48 60.95954513132033, 11 54.52605141049374,
28 59.72835627906529, 5 36.99902912183148,
2 43.97923463497827, 8 44.15540128592099,
48 52.390330271493546, 4 33.39155300220832,

[18.3333   43.9192  8.6842   38.0105
13.1728    8.0611  8.5248    8.2331]