 # code for basis

     basis = np.zeros((nx * 2, 5))
     basis[:, 0] = np.array([6., 6.8, 7., 7.4, 7.8, 8.2, 8.8, 9.2, 10., 11.4, 12.2, 13.4, 20., 0.,
                             1.8, 3.8, 5.8, 6.6, 8.4, 10.2, 11.4, 13., 14.6, 15.6, 17.2, 20.])
    
     basis[:, 1] = np.array([6., 7.48513957, 7.81997223, 8.41189715, 8.16728452, 8.4708108,
                             9.54454019, 10.26686085, 10.23037205, 11.8109363, 12.50000342,
                             13.90636496, 20., 0., 2.0736383, 4.67533416, 5.96686564, 6.86340497,
                             9.41861856, 10.78509445, 12.22915791, 14.02335437, 15.74004816,
                             15.89395627, 17.42943277, 20.])
    
     basis[:, 2] = np.array([6., 7.38689286, 7.72294127, 8.32688833, 7.95670251, 8.2823111,
                             9.52535605, 10.02413205, 10.1637055, 11.67041769, 12.35053234, 13.8070384, 20.,
                             0., 1.82531358, 4.51620829, 5.90799749, 6.79589611, 9.34822995,
                             10.73910471, 11.9835629, 13.93064889, 15.66466243, 15.67794821, 17.28655007, 20.])
    
     basis[:, 3] = np.array([6., 5.7827818, 7.14493751, 8.71040373, 6.53284159, 8.47767034, 7.65621351,
                             9.13904636, 13.82271469, 11.30440854, 13.97073257, 12.89681254, 20.,
                             0., -1.30811039, 3.2724712, 7.85075504, 8.92565511,
                             10.22626494, 9.76080429, 12.88540459, 12.96289298, 18.23389962, 17.60080336,
                             16.14748156, 20.])
     basis[:, 4] = np.array([6., 5.74133844, 7.33800593, 8.98332517, 6.50921693, 8.55970013,
                             7.61256167, 9.31338245, 13.91569761, 11.38711136, 14.09736454, 12.88094703,
                             20., 0., -1.21644538, 2.99286283, 7.82685527, 8.886719,
                             10.30002114, 9.83331944, 12.8647886, 13.0071202, 18.33810794, 17.65912744,
                             16.14631291, 20.])
     eta = 1e-1   Note: step size rule 1 does not work well when dimension is larger than 2  1e-2
     delta = 1e-1   exploration parameter
     nw = 5
     wt = np.zeros((nw, maxItr))
     wt[:, 0] = np.array([1, 0, 0, 0, 0])
     meas = np.zeros((maxItr,))   Distance me
    
     for i in range(maxItr - 1):
         x = np.reshape(np.matmul(basis, wt[:, i]), (nx*2, 1))
         s, index = human_feedback(x, human_cluster)
         meas[i] = s
         if s < 1e-2:
             break
         ut = np.random.random((nw, ))
         ut = ut / np.linalg.norm(ut)
         w_plus = wt[:, i] + ut * delta
         x_plus = np.reshape(np.matmul(basis, w_plus), (nx * 2, 1))
         s_plus, _ = human_feedback(x_plus, human_cluster)
         w_minus = wt[:, i] - ut * delta
         x_minus = np.reshape(np.matmul(basis, w_minus), (nx * 2, 1))
         s_minus, _ = human_feedback(x_minus, human_cluster)
    
         gt = nw / 2 / delta * (s_plus - s_minus) * ut   gradient
    
         wt[:, i + 1] = wt[:, i] - eta * gt.ravel()   gradient descent
         print(i, s, wt[:, i + 1])
    
     x = np.reshape(np.matmul(basis, wt[:, i]), (nx*2, 1))
     workspace_plot(x, nx, human_cluster, obstacle)
     plt.show()
 
 
 # count the number of points in the polygon
    # for polygon in human_cluster.values():
    #     cluster = Polygon(polygon)
    #     point = []
    #     for i in range(nx):
    #         if Point((x[i], x[i+nx])).within(cluster):
    #             point.append((x[i], x[i+nx]))
    #     # point in polygon
    #     if point:
    #         score += get_score(point, polygon)
    
  # workspace
  
    # w = Workspace()
    # with open('data/workspace', 'wb') as filehandle:
    #     pickle.dump(w, filehandle)
    # with open('data/case1', 'rb') as filehandle:
    #     w = pickle.load(filehandle)
    # print(w.regions)
    # w.init_goal = {'s': (6, 0), 't': (13, 17)}
    # w.plot_workspace()
    # plt.grid(b=True, which='major', color='k', linestyle='--')
    # plt.show()

# distance between the center of cluster and trajectory
    # def get_score(point, polygon):
    #     rho = 10
    #     cx, cy, r = make_circle(polygon)
    #     score = 0
    #     for p in point:
    #         score += rho/(np.linalg.norm(np.array(p) - np.array([cx, cy])))
    #     return score

# parameter
1. for distance to the center, 

eta = 1e-2  # Note: step size rule 1 does not work well when dimension is larger than 2  
delta = 1e0  # exploration parameter

2. for counting the number

eta = 1e-1  # Note: step size rule 1 does not work well when dimension is larger than 2 
delta = 1e1  # exploration parameter

3.   dist = np.sum([np.linalg.norm([x[i] - x[i + 1], x[i + nx] - x[i + 1 + nx]]) for i in range(nx - 1)])
     
     for obstacles, score += 10 or 1
     
     if np.fabs(dist-dist0) < 1 and s-dist < 1e-2:
        break
      
# result

locally perturbation works better than full perturbation when the length doubles


# static 
eta = 1e-1, score = score + dist
### k = 20
update iter - full/local
0-0 0-1 1-0 1-1 2-0 2-1 3-0 3-1 
[59, 56, 9, 33, 111, 27, 8, 1, 
1, 5, 8, 4, 17, 1, 106, 44, 
29, 12, 228, 118, 147, 39, 55, 76, 
42, 46, 22, 4, 39, 5, 26, 36, 
1, 1, 1, 1, 1, 1, 40, 20, 
2, 5, 17, 19, 35, 4, 29, 10, 
1, 1, 1, 1, 1, 1, 1, 1, 
23, 19, 21, 23, 1, 47, 90, 43, 
1, 1, 23, 32, 129, 46, 27, 30, 
181, 62, 1, 1, 227, 1, 69, 9, 
156, 197, 1, 1, 4, 48, 1, 1, 
5, 2, 1, 2, 1, 1, 1, 1, 
45, 10, 35, 48, 1, 1, 1, 1, 
1, 1, 62, 7, 1, 1, 1, 1, 
1, 1, 224, 26, 243, 9, 23, 23, 
29, 113, 72, 39, 37, 17, 14, 15, 
1, 10, 21, 4, 1, 1, 1, 1, 
227, 12, 33, 58, 158, 55, 1, 1, 
35, 120, 81, 12, 93, 89, 9, 20,]

44.2105   35.4737   45.3158   22.7895   65.6316   20.7368   26.4737   17.5789
67.5899   53.7860   68.0605   29.0337   80.7418   25.8990   32.0839   20.5867

### k = 30
[27, 4, 23, 6, 5, 6, 1, 1, 
53, 35, 333, 15, 54, 22, 1, 1, 
54, 82, 60, 26, 59, 1, 26, 16, 
21, 8, 17, 11, 47, 301, 147, 66, 
66, 11, 11, 32, 65, 19, 43, 57, 
72, 130, 36, 4, 1, 1, 51, 2, 
711, 10, 39, 26, 106, 21, 22, 38, 
81, 31, 263, 141, 813, 4, 37, 1, 
8, 13, 160, 17, 152, 48, 35, 6, 
74, 34, 108, 248, 371, 62, 25, 15, 
15, 10, 7, 19, 84, 63, 81, 33, 
54, 9, 1, 1, 74, 14, 10, 59, 
44, 56, 50, 87, 13, 2, 21, 7, 
80, 21, 70, 42, 25, 105, 4, 4, 
112, 51, 174, 36, 53, 99, 28, 47, 
1, 6, 46, 21, 146, 38, 6, 14, 
9, 8, 1, 7, 7, 4, 21, 1, 
22, 14, 5, 8, 22, 42, 1, 1, 
8, 5, 9, 20, 2, 1, 1, 1, 
1, 1, 38, 38, 1, 1, 1, 4, ]
75.6500   26.9500   72.5500   40.2500  105.0000   42.7000   28.1000   18.7000
152.9105   32.1108   91.9957   58.6855  186.8430   68.7651   34.8152   22.5227
### k = 40
[22, 37, 100, 24, 49, 14, 270, 33, 
44, 9, 17, 141, 67, 16, 37, 12, 
45, 50, 34, 23, 50, 60, 317, 15, 
263, 24, 28, 28, 52, 2, 3, 4, 
61, 98, 2, 6, 12, 111, 35, 53, 
19, 8, 98, 10, 36, 20, 3, 63, 
56, 82, 34, 93, 319, 347, 660, 80, 
93, 68, 417, 178, 24, 32, 2, 4, 
264, 112, 640, 18, 172, 14, 84, 31, 
32, 34, 28, 23, 22, 9, 47, 41, 
48, 31, 155, 58, 49, 18, 47, 81, 
16, 48, 105, 12, 15, 20, 18, 59, 
57, 14, 46, 9, 42, 22, 29, 4, 
1, 1, 16, 26, 14, 17, 22, 37, 
92, 6, 38, 84, 71, 29, 1, 1, 
199, 20, 66, 18, 1, 1, 1, 1, 
19, 18, 48, 20, 7, 20, 64, 35, 
2, 6, 65, 14, 108, 7, 56, 7, 
11, 110, 80, 10, 10, 6, 2, 12,]

70.7368   40.8421  106.1579   41.8421   58.9474   40.2632   89.3684   30.1579
81.4765   36.4437  157.9902   48.4014   75.0403   78.3545  163.3365   26.7463
### k = 50
[171, 25, 164, 26, 265, 240, 329, 18, 
33, 23, 14, 91, 169, 24, 167, 132, 
30, 76, 1319, 61, 75, 122, 419, 89, 
178, 92, 112, 32, 97, 29, 77, 70, 
88, 17, 59, 39, 349, 27, 165, 12, 
45, 65, 60, 13, 31, 22, 33, 8, 
45, 85, 62, 56, 218, 18, 55, 55, 
80, 188, 67, 34, 74, 81, 222, 143, 
364, 225, 183, 46, 33, 8, 31, 18, 
166, 140, 55, 446, 72, 5, 8, 1, 
19, 202, 61, 2, 59, 290, 1, 1, 
108, 27, 50, 30, 859, 65, 315, 11, 
30, 112, 41, 209, 65, 7, 50, 29, 
36, 20, 12, 3, 18, 56, 2, 3, 
92, 22, 56, 38, 586, 152, 137, 21, 
107, 21, 72, 34, 64, 283, 314, 71, 
122, 163, 21, 77, 90, 187, 106, 40, 
387, 47, 109, 46, 237, 17, 6, 24, 
105, 147, 57, 182, 40, 415, 259, 21, 
45, 28, 24, 60, 313, 274, 294, 102 ]

112.5500   86.2500  129.9000   76.2500  185.7000  116.1000  149.5000   43.4500
102.5072   69.0133  283.4336  101.6697  213.1723  123.4943  133.0111   43.7053

### k = 60
[403, 73, 53, 70, 67, 55, 158, 30,
228, 127, 46, 112, 197, 126, 249, 116,
137, 92, 84, 257, 54, 94, 87, 29,
95, 102, 210, 283, 59, 245, 368, 121,
49, 33, 242, 71, 559, 125, 259, 22,
53, 10, 29, 32, 47, 20, 73, 63,
32, 242, 56, 39, 32, 158, 252, 30,
47, 68, 26, 20, 557, 33, 217, 586,
42, 26, 492, 47, 112, 26, 16, 48,
54, 147, 198, 136, 416, 69, 12, 6,
119, 42, 115, 158, 83, 19, 130, 31,
44, 314, 267, 20, 39, 31, 51, 34,
69, 9, 277, 47, 10, 3, 194, 5,
25, 236, 12, 120, 14, 24, 60, 42,
18, 36, 96, 341, 151, 49, 23, 71,
38, 27, 274, 45, 22, 63, 95, 122,
36, 34, 430, 23, 91, 21, 30, 29,
134, 38, 192, 7, 20, 34, 71, 253,
167, 17, 27, 13, 23, 19, 78, 16, ]

94.2105   88.0526  164.5263   96.8947  134.3684   63.8947  127.5263   87.0526
93.4122   88.4204  140.3228   98.5776  176.2915   61.4382  101.8389  134.5525

# online

